<app-modal [isOpen]="isOpen" title="Add Signature" (onClose)="onClose.emit()">
    <div class="space-y-8">
        <!-- Tabs -->
        <div class="flex border-b border-slate-100">
            <button *ngFor="let tab of tabs" (click)="activeTab = tab.id" [class]="tabClasses(tab.id)">
                {{ tab.label }}
            </button>
        </div>

        <!-- Content -->
        <div [ngSwitch]="activeTab" class="min-h-[250px] relative">
            <app-signature-pad *ngSwitchCase="'draw'" #sigPad [penColor]="selectedColor"></app-signature-pad>
            <app-type-signature *ngSwitchCase="'type'" #typeSigComp (onSignatureChange)="onTypeChange($event)"
                [color]="selectedColor" [fontSize]="selectedFontSize"></app-type-signature>
            <app-image-upload *ngSwitchCase="'upload'" #imageUploadComp
                (onImageSelected)="onImageSelect($event)"></app-image-upload>

            <!-- Color Selection Floating -->
            <div *ngIf="activeTab !== 'upload'"
                class="absolute top-2 right-2 flex flex-col gap-2 p-2 bg-white/80 backdrop-blur-sm rounded-lg shadow-sm border border-slate-100">
                <button *ngFor="let color of colors" (click)="selectedColor = color.value"
                    [class]="'w-6 h-6 rounded-full transition-transform hover:scale-110 shadow-sm ' + color.class + (selectedColor === color.value ? ' ring-2 ring-offset-2 ring-primary-500 scale-110' : '')"
                    [title]="color.name"></button>
            </div>
        </div>

        <!-- Date Toggle -->
        <div class="flex items-center justify-between p-5 bg-slate-50 rounded-lg border border-slate-200">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-white rounded-md shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-slate-400">
                        <rect width="18" height="18" x="3" y="4" rx="2" ry="2" />
                        <line x1="16" x2="16" y1="2" y2="6" />
                        <line x1="8" x2="8" y1="2" y2="6" />
                        <line x1="3" x2="21" y1="10" y2="10" />
                    </svg>
                </div>
                <div class="flex flex-col">
                    <span class="text-sm font-semibold text-slate-800">Date Stamp</span>
                    <span class="text-xs text-slate-500">Append today's date automatically</span>
                </div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" [(ngModel)]="includeDate" class="sr-only peer">
                <div
                    class="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-500">
                </div>
            </label>
        </div>
    </div>

    <div footer class="flex gap-3">
        <app-button variant="ghost" (onClick)="onClose.emit()" className="text-slate-500">Discard</app-button>
        <app-button (onClick)="save()" className="px-8 rounded-full">Apply</app-button>
    </div>
</app-modal>